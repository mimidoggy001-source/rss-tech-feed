      - name: Send digest to DingTalk
        env:
          DINGTALK_WEBHOOK: ${{ secrets.DINGTALK_WEBHOOK }}
        run: |
          python <<EOF
          import os, json, datetime, subprocess, urllib.request

          webhook = os.environ.get("DINGTALK_WEBHOOK")
          if not webhook:
              raise SystemExit("DINGTALK_WEBHOOK æœªé…ç½®ï¼Œè¯·åœ¨ä»“åº“ Settings â†’ Secrets é‡Œæ·»åŠ ")

          # è°ƒç”¨ GitHub å®˜æ–¹ç¿»è¯‘ API
          def translate_to_cn(text):
              try:
                  result = subprocess.check_output(
                      [
                          "gh", "api",
                          "https://api.github.com/markdown",
                          "-f", f"text=Translate to Chinese:\n{text}"
                      ],
                      text=True
                  )
                  # GitHub Markdown API è¿”å› HTMLï¼Œéœ€è¦ç®€å•æ¸…æ´—ä¸€ä¸‹
                  result = result.replace("<p>", "").replace("</p>", "").strip()
                  return result
              except Exception as e:
                  return f"(ç¿»è¯‘å¤±è´¥){text}"

          # è¯»å–åˆšæ‰ç”Ÿæˆçš„ feeds.json
          with open("feeds.json", "r", encoding="utf-8") as f:
              data = json.load(f)

          items = data[:12]  # å‰ 12 æ¡æ›´é€‚åˆé’‰é’‰

          now = datetime.datetime.utcnow() + datetime.timedelta(hours=8)
          ts = now.strftime("%Y-%m-%d %H:%M")

          lines = []
          lines.append(f"### ğŸŒ çƒ­ç‚¹å…¨çƒç§‘æŠ€åª’ä½“æ—¥æŠ¥ï¼ˆ{ts} åŒ—äº¬æ—¶é—´ï¼‰\\n\\n")
          lines.append("- æ¥æºï¼šTechCrunch / The Verge / Engadget / Wired / IGN / Bloomberg ç­‰\\n")
          lines.append(f"- ä»Šæ—¥æŠ“å–ï¼š{len(items)} æ¡\\n\\n")

          for i, item in enumerate(items, 1):
              title = item.get("title") or ""
              plat = item.get("platform") or "æœªçŸ¥æ¥æº"
              url = item.get("url") or ""

              # ç¿»è¯‘æ ‡é¢˜
              zh_title = translate_to_cn(title)

              lines.append(f"{i}. **[{plat}]** {zh_title}\\n")
              lines.append(f"ğŸ”— {url}\\n\\n")

          text = "".join(lines)

          if len(text) > 19000:
              text = text[:19000] + "\\n...(å†…å®¹è¿‡é•¿å·²æˆªæ–­)"

          payload = {
              "msgtype": "markdown",
              "markdown": {
                  "title": "çƒ­ç‚¹å…¨çƒç§‘æŠ€åª’ä½“æ—¥æŠ¥",
                  "text": text
              }
          }

          data_bytes = json.dumps(payload).encode("utf-8")
          req = urllib.request.Request(
              webhook,
              data=data_bytes,
              headers={"Content-Type": "application/json"}
          )
          with urllib.request.urlopen(req) as resp:
              print("DingTalk response:", resp.read().decode("utf-8"))
          EOF
